name: Hourly Notion Task Sync

on:
  # This schedule runs the script at the top of every hour.
  schedule:
    - cron: '0 * * * *'
  # This allows you to manually trigger the script from the Actions tab in GitHub.
  workflow_dispatch:

jobs:
  run-python-script:
    runs-on: ubuntu-latest
    steps:
      # Step 1: Checks out your repository's code so the job can access it.
      - name: Check out repository
        uses: actions/checkout@v4

      # Step 2: Sets up the Python environment.
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      # Step 3: Installs the required Python libraries from your requirements.txt file.
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # Step 4: Runs your main.py script.
      - name: Run Notion Sync Script
        env:
          # This securely passes your GitHub secrets to the Python script.
          NOTION_API_KEY: ${{ secrets.NOTION_API_KEY }}
          TASKS_DB_ID: ${{ secrets.TASKS_DB_ID }}
          WEEKLY_DB_ID: ${{ secrets.WEEKLY_DB_ID }}
          MONTHLY_DB_ID: ${{ secrets.MONTHLY_DB_ID }}
        run: python main.py
